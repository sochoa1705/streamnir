<div class="modal__flight">
	<div class="modal__flight__header">
		<h4>Detalle de itinerario</h4>
		<img src="./assets/svg/close-modal.svg" (click)="activeModal.close();" />
	</div>
	<div class="modal__flight__body" *ngIf="flight">
		<ng-container *ngFor="let departure of flight.departure; index as i">
			<div class="modal__flight__body__flight">
				<div class="modal__flight__body__flight__header">
					<span class="type-flight">Salida a {{ departure.destinationCity.name | titlecase }} 
						<span class="dot">•</span>
						<span>{{ (departure.departureDate | formdate | date: 'EE d MMM')?.split('.')?.join(' ') }}</span></span
					>
					<span class="duration">
					    <span class="d-none d-sm-block">Duración total:</span>
						<strong>{{ departure.segments[indexSegmentDeparture[i]].flightDuration | flightDuration }}</strong></span
					>
				</div>
				<div class="modal__flight__body__flight__info">
					<ng-container
						*ngFor="
							let scala of departure.segments[indexSegmentDeparture[i]].flightSegments as flightSegment;
							index as i2
						"
					>
						<div class="modal__flight__body__flight__info__airline">
							<img [src]="scala.marketingAirline.imageUrl" alt="" />
							<span>{{ scala.flightNumber }} • Operado por {{ scala.marketingAirline.name }}</span>
						</div>

						<div class="modal__flight__body__flight__info__segment">
							<div class="modal__flight__body__flight__info__segment__row">
								<span class="bold right"
									>{{ scala.departureDateTime | date: 'HH:mm' }} {{ scala.departureDateTime | ampm }}</span
								>
								<img src="./assets/svg/ellipse2.svg" />
								<span
									><span class="bold country">{{ scala.departureAirport.name | titlecase }}</span
									><span class="regular"
										>{{ scala.departureAirport.airport | airport }} ({{ scala.departureAirport.code }})</span
									></span
								>
							</div>

							<img class="modal__flight__body__flight__info__segment__dots" src="./assets/svg/dots.svg" />

							<div class="modal__flight__body__flight__info__segment__row">
								<span class="right">{{ scala.elapsedTime | flightDuration }}</span>
								<img src="./assets/svg/airplane.svg" />
								<div class="tag" *ngIf="isHoursNocturne(scala.departureDateTime)">Vuelo nocturno</div>
							</div>

							<img class="modal__flight__body__flight__info__segment__dots" src="./assets/svg/dots.svg" />

							<div class="modal__flight__body__flight__info__segment__row">
								<span class="bold right"
									>{{ scala.arrivalDateTime | date: 'HH:mm' }} {{ scala.arrivalDateTime | ampm }}</span
								>
								<img src="./assets/svg/arrival.svg" />
								<span
									><span class="bold">{{ scala.arrivalAirport.name | titlecase }}</span
									><span class="regular"
										>{{ scala.arrivalAirport.airport | airport }} ({{ scala.arrivalAirport.code }})</span
									>
									<span
										class="arrival"
										*ngIf="
											!isEqualDates(
												scala.arrivalDateTime,
												i2 == 0
													? departure.departureDate
													: departure.segments[indexSegmentDeparture[i]].flightSegments[i2 - 1].arrivalDateTime,
												i2
											)
										"
										>Llega el {{ (scala.arrivalDateTime | date: 'EE d MMM')?.split('.')?.join(' ') }}</span
									>
								</span>
							</div>
						</div>
						<div
							class="modal__flight__body__flight__info__change__plane"
							*ngIf="flightSegment.length > 1 && i2 < flightSegment.length - 1"
						>
							<span class="hour bold">{{
								calcDurationScale(scala.arrivalDateTime, flightSegment[i2 + 1].departureDateTime)
							}}</span>
							<img src="./assets/svg/time.svg" />
							<span
								>Cambio de avión en <span class="bold">{{ scala.arrivalAirport.name | titlecase }}</span></span
							>
						</div>
					</ng-container>
					<div class="modal__flight__body__flight__info__bags">
						<span>Equipaje incluido:</span>
						<app-tooltip
							[isTop]="!flight.returns && flight.departure.length - 1 == i"
							[isRight]="false"
							[isHandLuggage]="departure.segments[indexSegmentDeparture[i]].equipaje?.cabina ? true : false"
							[isHoldLuggage]="departure.segments[indexSegmentDeparture[i]].equipaje?.piezas ?? 0 > 0 ? true : false"
						></app-tooltip>
					</div>
				</div>
			</div>
			<div class="modal__flight__body__line" *ngIf="i < flight.departure.length - 1"></div>
		</ng-container>
		<ng-container *ngIf="flight.returns as returns">
			<div class="modal__flight__body__line"></div>
			<div class="modal__flight__body__flight">
				<div class="modal__flight__body__flight__header">
					<span class="type-flight"
						>Vuelta a {{ returns.destinationCity.name | titlecase }} 
						<span class="dot">•</span>
						<span>{{ (returns.departureDate | formdate | date: 'EE d MMM')?.split('.')?.join(' ') }}</span></span
					>
					<span class="duration">
						<span class="d-none d-sm-block">Duración total:</span>
						<strong>{{ returns.segments[indexSegmentReturn].flightDuration | flightDuration }}</strong></span
					>
				</div>
				<div class="modal__flight__body__flight__info">
					<ng-container
						*ngFor="let scala of returns.segments[indexSegmentReturn].flightSegments as flightSegment; index as i3"
					>
						<div class="modal__flight__body__flight__info__airline">
							<img [src]="scala.marketingAirline.imageUrl" alt="" />
							<span>{{ scala.flightNumber }} • Operado por {{ scala.marketingAirline.name }}</span>
						</div>

						<div class="modal__flight__body__flight__info__segment">
							<div class="modal__flight__body__flight__info__segment__row">
								<span class="bold right"
									>{{ scala.departureDateTime | date: 'HH:mm' }} {{ scala.departureDateTime | ampm }}</span
								>
								<img src="./assets/svg/ellipse2.svg" />
								<span
									><span class="bold country">{{ scala.departureAirport.name | titlecase }}</span
									><span class="regular"
										>{{ scala.departureAirport.airport | airport }} ({{ scala.departureAirport.code }})</span
									></span
								>
							</div>

							<img class="modal__flight__body__flight__info__segment__dots" src="./assets/svg/dots.svg" />

							<div class="modal__flight__body__flight__info__segment__row">
								<span class="right">{{ scala.elapsedTime | flightDuration }}</span>
								<img src="./assets/svg/airplane.svg" />
								<div class="tag" *ngIf="isHoursNocturne(scala.departureDateTime)">Vuelo nocturno</div>
							</div>

							<img class="modal__flight__body__flight__info__segment__dots" src="./assets/svg/dots.svg" />

							<div class="modal__flight__body__flight__info__segment__row">
								<span class="bold right"
									>{{ scala.arrivalDateTime | date: 'HH:mm' }} {{ scala.arrivalDateTime | ampm }}</span
								>
								<img src="./assets/svg/arrival.svg" />
								<span
									><span class="bold">{{ scala.arrivalAirport.name | titlecase }}</span
									><span class="regular"
										>{{ scala.arrivalAirport.airport | airport }} ({{ scala.arrivalAirport.code }})</span
									>

									<span
										class="arrival"
										*ngIf="
											!isEqualDates(
												scala.arrivalDateTime,
												i3 == 0
													? returns.departureDate
													: returns.segments[indexSegmentReturn].flightSegments[i3 - 1].arrivalDateTime,
												i3
											)
										"
										>Llega el {{ (scala.arrivalDateTime | date: 'EE d MMM')?.split('.')?.join(' ') }}</span
									>
								</span>
							</div>
						</div>
						<div
							class="modal__flight__body__flight__info__change__plane"
							*ngIf="flightSegment.length > 1 && i3 < flightSegment.length - 1"
						>
							<span class="hour bold">{{
								calcDurationScale(scala.arrivalDateTime, flightSegment[i3 + 1].departureDateTime)
							}}</span>
							<img src="./assets/svg/time.svg" />
							<span
								>Cambio de avión en <span class="bold">{{ scala.arrivalAirport.name | titlecase }}</span></span
							>
						</div>
					</ng-container>
					<div class="modal__flight__body__flight__info__bags">
						<span>Equipaje incluido:</span>
						<app-tooltip
							[isTop]="true"
							[isRight]="false"
							[isHandLuggage]="returns.segments[indexSegmentReturn].equipaje?.cabina ? true : false"
							[isHoldLuggage]="returns.segments[indexSegmentReturn].equipaje?.piezas ?? 0 > 0 ? true : false"
						></app-tooltip>
					</div>
				</div>
			</div>
		</ng-container>
	</div>
	<div class="modal__flight__footer" *ngIf="detailPricing">
		<h4>$ {{ detailPricing.totalPay | number: '1.2-2' }}</h4>
		<app-button [text]="'Continuar'" [isMobile]="true" (click)="openModalUpsell()"></app-button>
	</div>
</div>
